---
layout: post
title: "Persistence Through Unstable Internet Connections"
comments: true
date: 2019-12-29
---

I took a couple of days off posting, finishing off the actual (though still basic) chat feature of ChatScrypt. There are multiple design choices to discuss; in this post I would like to discuss the matter of maintaining a coherent chat session through intermittent internet reconnection events.

<p>Philosophically, obtaining security and stability coincide nicely, since both require me to keep an eye on each time a signal is sent from the client/broser to the server. It is convenient to think about the client as an offline program, sending and receiving messages to and from the server on rare occasions. At the moment, aside from login and logout, I have isolated communications into three situations:

<ul>
<li> adding users to your contacts list,
<li> sending messages,
<li> and receiving messages.
</ul>

There are a few small design choices underlying each case:

<h2> The Contact List

This is actually a bit controversial and subject to change, due to the question of whether it is secure to store all of a user's interactions with other users in one list. I decided to include one for now, because:

<ul>
<li> At the moment is is convenient as simply a way to isolate the matter of verifying whether a username/contact matches an existing account, as this requires confirmation from the server. The existence of a contacts list makes message drafting a purely offline matter.

<li> The (future) feature of autocompleting past recipients is too convenient to pass over and requires a contact list one way or another. 

<li> I actually haven't thought or read much about the possibility of a chat client that can perform its duties with no awareness of who is talking to who. I'm not sure it's possible. (I could simply promise not to save contact information into a database, but I think that promise is weak enough that the former two usability points win.)
<ul>


<h2> Sending Messages

Uncontroversial as far as I can tell: Rather than emitting messages immediately, I stage them in a message queue offline, and remove theme as the server confirms successful receipt. Currently, the message queue is visually implemented via italics (the standard font is restored after a successful send).

Note: If a chat window is closed, its corresponding message queue is erased.

<h3> Receiving Messages

I had some design choices to make here:

<ul>
<li> In the style of email, and in contrast to services like Gchat, chat windows can only be-initiated by the user (in Gchat and I believe other apps, a new message will pop open a new chat window). The list of chats updates real-time. The philosophy is that windows should not appear unprompted, especially where the user might be actively clicking. 

<li>Chat windows already open do receive messages real-time, of course. On reconnect from a disconnect, they reload messages from the database (and hence any messages that would have been received during any downtime).
</ul> 
